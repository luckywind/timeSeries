---
title: "è´µå·çœå…­ç›˜æ°´å¸‚å·çƒŸé”€å”®é¢„æµ?"
author: "ç¨‹å¹¸ç¦?"
date: "2016å¹?6æœ?5æ—?"
output: word_document
---
#1 é”€å”®æ•°æ®æ•´ç?
```{r}
sj = read.csv("shengjian.csv")
lps = sj[sj$å¸‚å…¬å?=="å…­ç›˜æ°´å¸‚",]
rownames(lps) <- 1:nrow(lps)
#é‡æ’
init.index=c(1,3,2,4)
index=NULL
for(i in 1:(dim(lps)[1]/4)){
index=c(index,init.index)
init.index=init.index+4
}
lps = lps[index,]
#ç”»å›¾
lps_sale_ts =ts(lps$é”€é‡?.ç®?.,start=c(2006,1),frequency=4)
plot(lps_sale_ts,ylab="é”€é‡?(ç®?)",main="å·çƒŸé”€å”®é‡")
```
#åˆ†è§£
```{r}
#multiplicativeä»£è¡¨ä¹˜æ³•æ¨¡å‹ï¼Œadditiveæ˜¯å¯åŠ æ¨¡å?
#å‡½æ•°é¦–å…ˆç”¨ç§»åŠ¨å¹³å‡æ³•å†³å®šè¶‹åŠ¿æˆåˆ†ï¼Œå¹¶ä»åŸå§‹åºåˆ—å‡å»è¶‹åŠ?
#å­£èŠ‚æ€§çš„è®¡ç®—æ˜¯é€šè¿‡å¯¹æ¯ä¸ªå­£èŠ‚å–ç›¸åº”å¹³å‡å€¼å¾—åˆ?
#å»æ‰è¶‹åŠ¿å’Œå­£èŠ‚é¡¹å¾—åˆ°æ®‹å·®
decompearn =decompose(lps_sale_ts, type ="multiplicative")

plot(decompearn)
```

#2 åˆ†æ
```{r}
library(TSA)
acf(lps_sale_ts,main="å‘¨æœŸæ€?")
pacf(lps_sale_ts)
```

#3 å»è¶‹åŠ?
```{r}
plot(diff(lps_sale_ts),xlab="é”€å”®é‡(ç®?)",main="é”€é‡ä¸€é˜¶å·®åˆ?")
acf(diff(lps_sale_ts))
pacf(diff(lps_sale_ts))
```

#4 å­£èŠ‚å·®åˆ†
```{r}
plot(diff(lps_sale_ts,lag = 4))
acf(diff(lps_sale_ts,lag = 4))
pacf(diff(lps_sale_ts,lag = 4))
```

#5 å»è¶‹åŠ¿åè¿›è¡Œå­£èŠ‚å·®åˆ†
```{r}
plot(diff(diff(lps_sale_ts,lag = 4)))
acf(diff(diff(lps_sale_ts,lag = 4)))
pacf(diff(diff(lps_sale_ts,lag = 4)))
```

#3 å»ºæ¨¡
```{r}
lps_m1 = arima(lps_sale_ts,order = c(1,0,1),seasonal = list(order = c(1,1,1),period=4))
lps_m1
#sigma^2 estimated as 3645936:  log likelihood = -325.61,  aic = 661.22
lps_m2 = arima(lps_sale_ts,order = c(0,0,0),seasonal = list(order = c(0,1,0),period=4))
lps_m2
#sigma^2 estimated as 5437696:  log likelihood = -330.24,  aic = 660.48
#sigma^2 estimated as 5437696:  log likelihood = -330.24,  aic = 662.48
lps_m3 = arima(lps_sale_ts,order = c(0,1,0),seasonal = list(order = c(0,1,0),period=4))
lps_m3
#sigma^2 estimated as 8224071:  log likelihood = -328.31,  aic = 656.62
lps_m4 = arima(lps_sale_ts,order = c(1,1,1),seasonal = list(order = c(0,1,0),period=4))
lps_m4
#sigma^2 estimated as 3824161:  log likelihood = -317.05,  aic = 638.1
lps_m5 = arima(lps_sale_ts,order = c(1,1,1),seasonal = list(order = c(1,1,1),period=4))
lps_m5
#sigma^2 estimated as 2868921:  log likelihood = -315.07,  aic = 638.13
lps_m6 = arima(lps_sale_ts,order = c(0,1,1),seasonal = list(order = c(0,1,0),period=4))
lps_m6
#sigma^2 estimated as 4169685:  log likelihood = -318.21,  aic = 640.43
lps_m7 = arima(lps_sale_ts,order = c(1,1,0),seasonal = list(order = c(0,1,0),period=4))
lps_m7
#sigma^2 estimated as 6874548:  log likelihood = -325.32,  aic = 654.64
lps_m8 = arima(lps_sale_ts,order = c(1,1,0),seasonal = list(order = c(0,1,1),period=4))
lps_m8
#sigma^2 estimated as 6247698:  log likelihood = -324.08,  aic = 654.17
lps_m9 = arima(lps_sale_ts,order = c(1,1,0),seasonal = list(order = c(1,1,1),period=4))
lps_m9
#sigma^2 estimated as 5676561:  log likelihood = -324.11,  aic = 656.22
#åŠ å…¥ä¸€ä¸ªå¯åŠ å¼‚å¸¸å€?
lps_m10 = arima(lps_sale_ts,order = c(1,1,1),seasonal = list(order = c(0,1,0),period=4),xreg = data.frame(t40=1*(seq(lps_sale_ts)==40)))
lps_m10
#sigma^2 estimated as 2378095:  log likelihood = -307.62,  aic = 621.24
#ä½¿ç”¨éå­£èŠ‚æ¨¡å?
# lps_m2 = arima(lps_sale_ts,order = c(4,0,12))
# lps_m2
```

#4 æ¨¡å‹è¯„ä¼°
```{r}
ModelCheck = function(tsmodel){
  tsdiag(tsmodel, gof.lag=36)
qqnorm(rstandard(tsmodel),main=expression(Normal~~Q-Q~~Plot))
qqline(rstandard(tsmodel))
}
ModelCheck(lps_m1)
#ModelCheck(lps_m2)
ModelCheck(lps_m3)
ModelCheck(lps_m4)
ModelCheck(lps_m5)
ModelCheck(lps_m10)
```


#5 æ‹Ÿåˆ
```{r}
fitting=function(tsmodel){
plot(lps_sale_ts)
lines(fitted(tsmodel),col='red')
points(lps_sale_ts,cex=0.5)
}
fitting(lps_m1)
fitting(lps_m2)
fitting(lps_m3)
fitting(lps_m4)
fitting(lps_m5)
fitting(lps_m10)

```

#6 é¢„æµ‹
```{r}
forcast = function(tsmodel,n){
 modelpredict = plot(tsmodel,n.ahead=n,col='red',xlab='Year',type='o',
ylab="é”€å”®é‡",
main="é”€é‡é¢„æµ?")
 str(modelpredict)
}
forcast(lps_m1,4)
forcast(lps_m2,4)
forcast(lps_m3,4)
forcast(lps_m4,4)
forcast(lps_m5,4)
```

```{r}
#åŠ å…¥å¼‚å¸¸å€¼çš„é¢„æµ‹
npred=4
newxreg <-ts(rep(0,4),frequency = 4, start = c(2016, 1))
# obtain the forecasts
p <-predict(lps_m10, n.ahead=npred, newxreg=newxreg)
# display forecasts
plot(cbind(lps_sale_ts, p$pred), plot.type = "single", ylab = "", type = "n")
lines(lps_sale_ts)
lines(p$pred, type = "l", col = "blue")
lines(p$pred + 1.96 * p$se, type = "l", col = "red", lty = 2)
lines(p$pred -1.96 * p$se, type = "l", col = "red", lty = 2)
legend("topleft", legend = c("observed data",
"forecasts", "95% confidence bands"), lty = c(1,1,2,2),
col = c("black", "blue", "red", "red"), bty = "n")
```



